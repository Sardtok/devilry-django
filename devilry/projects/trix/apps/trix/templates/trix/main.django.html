{% extends "trix/base.django.html" %}

{% load i18n %}

{% block title %}Ukesoppgaver{% endblock %}

{% block nav-class %}trix{% endblock %}

{% block headextra %}
  <link rel="stylesheet" href="{{ DEVILRY_STATIC_URL }}/trix/style.css" />
  <link rel="stylesheet" media="print"
        href="{{ DEVILRY_STATIC_URL }}/trix/print.css" />
  <script type="text/javascript">
    toggleExc = function(link) {
      elem = link;
      while (elem && elem.getAttribute("class") != "exctext") {
        do {
            elem = elem.nextSibling;
        } while (elem.nodeType !== 1);
      }

      if (elem) {
        if (elem.style.display == 'none') {
          elem.style.display = 'block';
          link.innerHTML = "{% trans "Hide exercise" %}";
        } else {
          elem.style.display = 'none';
          link.innerHTML = "{% trans "Show exercise" %}";
        }
      }
    }
  </script>
  <script src="{{DEVILRY_STATIC_URL}}/trix/setstatus.js"></script>
{% endblock %}

{% block main %}
{% include "trix/xpbar.django.html" %}
{% if user.is_authenticated %}
<div>{% trans "Total points" %}:
  <span id="total_points">{{ level.total_points }}</span>
</div>
{% endif %}

{% if topics %}
<div>{% trans "Topics" %}:
  {% for id, topic in topics.items %}
  {{ topic.name }}
  {% for statid, points in topicstats.items %}
  {% if statid == id %}
  ({{points}})
  {% endif %}
  {% endfor %}
  {% endfor %}</div>
{% endif %}

{% if prerequisites %}
<div>{% trans "Prerequisites" %}:
  {% for prerequisite in prerequisites.values %}
  {{ prerequisite.name }}
  {% endfor %}</div>
{% endif %}

{% for p, p_excs in exercises.items %}
  <form autocomplete="off">
  <table class="exercises">
    <caption>{% trans "Exercises" %} —
      {{ p.parentnode.long_name }} —
      {{ p.long_name }}</caption>
    <thead>
      <tr>
        <th
           {% if statuses %}class="maincol"{% endif %}
           >{% trans "Exercise" %}</th>
        {% if statuses %}
          {% for status in statuses %}
            <th class="statusbutton">{{ status.name }}</th>
          {% endfor %}
          <th class="statusbutton">{% trans "Unsolved" %}</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
        
      {% for id, e in p_excs.items %}
      <tr>
        <td
           {% if statuses %}class="maincol"{% endif %}
           >
          {% if statuses %}
          <a class="dispexc" href="javascript:void(0)"
             onClick="toggleExc(this)" style="float: right;">
            {% trans "Show exercise" %}
          </a>
          {% endif %}
          <h3>{{ e.title }}</h3>
          {% autoescape off %}
          <div class="exctext"
               {% if statuses %}style="display: none"{% endif %}
               >{{ e.text }}</div>
          {% endautoescape %}
        </td>
        {% if statuses %}
          {% for status in statuses %}
            <td class="statusbutton">
              <input type="radio" name="{{ id }}" value="{{ status.id }}"
                     {% if e.status == status.id %}
                     checked="checked"
                     {% endif %}
                     onChange="setStatus(this.name, this.value)"/>
            </td>
          {% endfor %}
          <td class="statusbutton">
            <input type="radio" name="{{ id }}" value="-1"
                     {% if e.status == -1 %}
                     checked="checked"
                     {% endif %}
                     onChange="setStatus(this.name, this.value)"/>
          </td>
        {% endif %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  </form>
{% endfor %}

{% endblock %}

